#include <string.h>
#include "AndroidVideoFairy.hpp"

// ファミコンのパレットテーブル (16bit color)
static const unsigned short _nesRgb555[64] = {
    0x3DEF, 0x001F, 0x0017, 0x20B7, 0x4810, 0x5404, 0x5440, 0x4440,
    0x28C0, 0x01E0, 0x01A0, 0x0160, 0x010B, 0x0000, 0x0000, 0x0000,
    0x5EF7, 0x01FF, 0x017F, 0x351F, 0x6C19, 0x700B, 0x7CE0, 0x7162,
    0x55E0, 0x02E0, 0x02A0, 0x02A8, 0x0231, 0x0000, 0x0000, 0x0000,
    0x7FFF, 0x1EFF, 0x363F, 0x4DFF, 0x7DFF, 0x7D73, 0x7DEB, 0x7E88,
    0x7EE0, 0x5FE3, 0x2F6A, 0x2FF3, 0x03BB, 0x3DEF, 0x0000, 0x0000,
    0x7FFF, 0x539F, 0x5EFF, 0x6EFF, 0x7EFF, 0x7E98, 0x7B56, 0x7F95,
    0x7F6F, 0x6FEF, 0x5FF7, 0x5FFB, 0x03FF, 0x7F7F, 0x0000, 0x0000};

AndroidVideoFairy::AndroidVideoFairy()
{
    memset(bitmap565, 0, sizeof(bitmap565));
}

AndroidVideoFairy::~AndroidVideoFairy()
{
}

void AndroidVideoFairy::dispatchRendering(const uint8_t (&nesBuffer)[screenHeight][screenWidth], const uint8_t paletteMask)
{
    int ptr = 0;
    for (int y = 0; y < screenHeight; y++) {
        for (int x = 0; x < screenWidth; x++) {
            bitmap565[ptr++] = _nesRgb555[nesBuffer[y][x] & paletteMask];
        }
    }
}
